<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Генератор паттерна ставок — Technical (Mobile Friendly)</title>
  <style>
    :root{
      --bg:#071427; --panel:#0f1724; --accent:#18a0fb; --muted:#9fb0c9; --card:#071428;
    }
    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,#071427 0%,#0b1220 100%);
      font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      color:#e6eef8;
      -webkit-font-smoothing:antialiased
    }
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px
    }
    .panel{
      width:100%;
      max-width:820px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:22px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow:0 10px 40px rgba(2,6,23,.7)
    }
    .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px
    }
    h1{
      font-size:18px;
      margin:0;
      color:var(--accent)
    }
    .subtitle{
      color:var(--muted);
      font-size:13px
    }

    .controls{
      display:flex;
      gap:12px;
      align-items:center;
      margin-top:16px
    }
    label{
      color:var(--muted);
      font-weight:600
    }
    input[type=number]{
      width:160px;
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:var(--panel);
      color:var(--muted);
      font-weight:600
    }
    .btn{
      background:linear-gradient(180deg,var(--accent),#0b84d6);
      border:none;
      color:#042129;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(24,160,251,0.18)
    }
    .btn.secondary{
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--muted);
      box-shadow:none;
      font-weight:600
    }

    .output{
      margin-top:18px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border-radius:10px;
      padding:18px;
      border:1px solid rgba(255,255,255,0.02)
    }
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-width:420px;
      margin:0 auto
    }
    .item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 14px;
      border-radius:8px;
      background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border:1px solid rgba(255,255,255,0.02)
    }
    .item .label{
      font-weight:800;
      color:#ffffff;
      font-size:16px
    }
    .item .meta{
      color:var(--muted);
      font-family:monospace;
      text-align:right
    }

    .footer{
      margin-top:14px;
      text-align:center;
      color:var(--muted);
      font-size:13px
    }

    /* MOBILE STYLES */
    @media (max-width:600px){
      .wrap{padding:12px}
      .panel{padding:16px;border-radius:14px}
      .head{flex-direction:column;align-items:flex-start;gap:8px}
      h1{font-size:17px}
      .controls{flex-direction:column;align-items:stretch}
      input[type=number]{width:100%}
      .btn{width:100%;padding:14px;border-radius:12px;font-size:16px}
      .btn.secondary{width:100%;margin-top:8px}
      .output{padding:14px}
      .list{max-width:100%}
      .item{padding:10px 12px}
      .item .label{font-size:18px}
      .item .meta{font-size:15px}
    }

    button:active{transform:translateY(1px)}
    input:focus{outline:none;box-shadow:0 6px 18px rgba(24,160,251,0.12)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="main">
      <div class="head">
        <div>
          <h1>Генератор паттерна ставок — Technical</h1>
          <div class="subtitle">
            5 строк стратегии: общая ставка по строке = ставка за спин × количество прокрутов. 
            Сумма всех общих ставок = ваш бюджет.
          </div>
        </div>
        <div class="subtitle">Коэффициенты и повторы настраиваются в коде</div>
      </div>

      <div class="controls">
        <div style="display:flex;flex-direction:column;gap:6px">
          <label for="budget">Бюджет (MAD)</label>
          <input id="budget" type="number" value="50" min="5" />
        </div>

        <div style="display:flex;flex-direction:column;gap:8px;justify-content:center">
          <button id="gen" class="btn" aria-label="Получить стратегию">Получить стратегию</button>
          <!-- regen button будет вставлен при первом запуске -->
        </div>
      </div>

      <div id="output" class="output" aria-live="polite" style="display:none">
        <div class="list" id="list"></div>
        <div class="footer" id="footer"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  // Настройки: веса и количество прокрутов
  const coeffs  = [1,2,1,2,4];   // "важность" строки (можно менять)
  const repeats = [5,3,4,2,5];   // количество прокрутов (ретов) по строкам

  // Генерация ставок: возвращаем ставку за один спин для каждой строки
  function computePerSpinPattern(budget){
    // базовые ставки от коэффициентов
    const sumCR = coeffs.reduce((s,c,i)=> s + c * repeats[i], 0);
    let base = coeffs.map(c => c * budget / sumCR); // базовая ставка за спин

    // добавим лёгкий рандом (±10%), чтобы паттерны отличались
    base = base.map(v => v * (0.9 + Math.random() * 0.2));

    // нормализуем обратно под бюджет с учётом повторов
    let weightedSum = base.reduce((s,v,i)=> s + v * repeats[i], 0);
    let perSpin = base.map(v => v * budget / weightedSum);

    // округляем до 2 знаков после запятой
    perSpin = perSpin.map(v => Math.round(v * 100) / 100);

    // фиксируем, чтобы сумма ровно равнялась бюджету (по общим ставкам)
    let total = perSpin.reduce((s,v,i)=> s + v * repeats[i], 0);
    let diff = Math.round((budget - total) * 100) / 100;

    if (Math.abs(diff) >= 0.01){
      const last = perSpin.length - 1;
      const adjust = diff / repeats[last];
      perSpin[last] = Math.round((perSpin[last] + adjust) * 100) / 100;
    }

    return perSpin;
  }

  function createRegenButton(){
    if(document.getElementById('regen')) return;
    const regen = document.createElement('button');
    regen.id = 'regen';
    regen.className = 'btn secondary';
    regen.style.marginTop = '8px';
    regen.innerText = 'Получить новую стратегию';
    regen.addEventListener('click', function(){
      document.getElementById('gen').click();
    });
    document.querySelector('.controls').appendChild(regen);
  }

  function render(budget, perSpin){
    const out    = document.getElementById('output');
    const list   = document.getElementById('list');
    const footer = document.getElementById('footer');
    list.innerHTML = '';

    let totalAll = 0;

    for(let i=0;i<5;i++){
      const stakePerSpin = perSpin[i];
      const spins        = repeats[i];
      const totalLine    = Math.round(stakePerSpin * spins * 100) / 100; // общая ставка по строке

      totalAll += totalLine;

      const div   = document.createElement('div'); 
      div.className = 'item';

      const label = document.createElement('div'); 
      label.className = 'label'; 
      label.innerText = `Общая ставка ${totalLine.toFixed(2)} MAD`;

      const meta  = document.createElement('div'); 
      meta.className = 'meta'; 
      meta.innerText = `${spins} рет · ${stakePerSpin.toFixed(2)} MAD за спин`;

      div.appendChild(label);
      div.appendChild(meta);
      list.appendChild(div);
    }

    footer.innerText = `Итого по стратегии: ${totalAll.toFixed(2)} MAD — Бюджет: ${budget} MAD`;
    out.style.display = 'block';
    createRegenButton();

    setTimeout(()=>{
      document.getElementById('output').scrollIntoView({behavior:'smooth', block:'start'});
    },120);
  }

  document.getElementById('gen').addEventListener('click', function(){
    const budget = parseFloat(document.getElementById('budget').value || '0');
    if(!budget || budget <= 0){
      alert('Введите корректный бюджет');
      return;
    }
    const perSpinPattern = computePerSpinPattern(budget);
    render(budget, perSpinPattern);
  });

})();
</script>
</body>
</html>
