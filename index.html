<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Генератор паттерна ставок — Technical (Mobile Friendly)</title>
  <style>
    :root{
      --bg:#071427; --panel:#0f1724; --accent:#18a0fb; --muted:#9fb0c9; --card:#071428;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071427 0%,#0b1220 100%);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color:#e6eef8;-webkit-font-smoothing:antialiased}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
    .panel{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:22px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(2,6,23,.7)}
    .head{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:18px;margin:0;color:var(--accent)}
    .subtitle{color:var(--muted);font-size:13px}

    .controls{display:flex;gap:12px;align-items:center;margin-top:16px}
    label{color:var(--muted);font-weight:600}
    input[type=number]{width:160px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--panel);color:var(--muted);font-weight:600}
    .btn{background:linear-gradient(180deg,var(--accent),#0b84d6);border:none;color:#042129;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(24,160,251,0.18)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);box-shadow:none;font-weight:600}

    .output{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:10px;padding:18px;border:1px solid rgba(255,255,255,0.02)}
    .list{display:flex;flex-direction:column;gap:10px;max-width:420px;margin:0 auto}
    .item{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.02)}
    .item .label{font-weight:800;color:#ffffff;font-size:16px}
    .item .meta{color:var(--muted);font-family:monospace}

    .footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}

    /* MOBILE STYLES */
    @media (max-width:600px){
      .wrap{padding:12px}
      .panel{padding:16px;border-radius:14px}
      .head{flex-direction:column;align-items:flex-start;gap:8px}
      h1{font-size:17px}
      .controls{flex-direction:column;align-items:stretch}
      input[type=number]{width:100%}
      .btn{width:100%;padding:14px;border-radius:12px;font-size:16px}
      .btn.secondary{width:100%;margin-top:8px}
      .output{padding:14px}
      .list{max-width:100%}
      .item{padding:10px 12px}
      .item .label{font-size:18px}
      .item .meta{font-size:15px}
    }

    /* Small touch targets and visual polish */
    button:active{transform:translateY(1px)}
    input:focus{outline:none;box-shadow:0 6px 18px rgba(24,160,251,0.12)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel" role="main">
      <div class="head">
        <div>
          <h1>Генератор паттерна ставок — Technical</h1>
          <div class="subtitle">Точный и прозрачный паттерн в 5 строк. Ставки идут в одном столбце, каждая ставка ≥ предыдущей.</div>
        </div>
        <div class="subtitle">Коэффициенты и повторы настраиваются в коде</div>
      </div>

      <div class="controls">
        <div style="display:flex;flex-direction:column;gap:6px">
          <label for="budget">Бюджет (MAD)</label>
          <input id="budget" type="number" value="320" min="5" />
        </div>

        <div style="display:flex;flex-direction:column;gap:8px;justify-content:center">
          <button id="gen" class="btn" aria-label="Получить стратегию">Получить стратегию</button>
          <!-- regen button will be inserted here on first run -->
        </div>
      </div>

      <div id="output" class="output" aria-live="polite" style="display:none">
        <div class="list" id="list"></div>
        <div class="footer" id="footer"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  'use strict';

  // Параметры паттерна (настраиваемые)
  const coeffs = [1,2,1,2,4];   // относительные веса для распределения бюджета
  const repeats = [5,3,4,2,5];  // отображаемые повторы

  function computePattern(budget){
  const coeffs = [1,2,1,2,4];   // веса ставок
  const repeats = [5,3,4,2,5];   // количество прокрутов

  // суммарный "вес с учётом повторов"
  const totalWeight = coeffs.reduce((sum, c, i) => sum + c * repeats[i], 0);

  // вычисляем ставки так, чтобы sum(ставка[i]*repeats[i]) = budget
  let raw = coeffs.map((c, i) => c * repeats[i] / totalWeight * budget);

  // округление вниз и распределение остатка
  let rounded = raw.map(v => Math.floor(v));
  let currentSum = rounded.reduce((s,v,i)=>s+v*repeats[i],0);
  let diff = budget - currentSum;

  // распределяем остаток по повторениям
  while(diff > 0){
    const idx = Math.floor(Math.random() * rounded.length);
    rounded[idx] += 1;
    diff -= repeats[idx]; // учитываем что ставка умножается на repeats
    if(diff < 0){ // если перебор, уменьшаем последнюю
      rounded[idx] += diff;
      diff = 0;
    }
  }

  // неубывающая последовательность ставок
  for(let i=1;i<rounded.length;i++){
    if(rounded[i] < rounded[i-1]){
      const need = rounded[i-1] - rounded[i];
      rounded[i] += need;
      rounded[rounded.length-1] = Math.max(rounded[rounded.length-1] - need, 0);
    }
  }

  return rounded;
}

  function createRegenButton(){
    if(document.getElementById('regen')) return;
    const regen = document.createElement('button');
    regen.id = 'regen'; regen.className = 'btn secondary'; regen.style.marginTop = '8px'; regen.innerText = 'Получить новую стратегию';
    regen.addEventListener('click', function(){ document.getElementById('gen').click(); });
    // вставляем под основную секцию controls
    const controls = document.querySelector('.controls');
    controls.appendChild(regen);
  }

  function render(budget, pattern){
    const out = document.getElementById('output');
    const list = document.getElementById('list');
    const footer = document.getElementById('footer');
    list.innerHTML = '';

    for(let i=0;i<5;i++){
      const div = document.createElement('div'); div.className='item';
      const label = document.createElement('div'); label.className='label'; 
      label.innerText = `Общая ставка ${rounded[i]} MAD x ${repeats[i]} = ${rounded[i]*repeats[i]} MAD`;
      const meta = document.createElement('div'); meta.className='meta'; meta.innerText = `${repeats[i]} рет`;
      div.appendChild(label); div.appendChild(meta);
      list.appendChild(div);
    }

    footer.innerText = `Итого распределено: ${pattern.reduce((s,v,i)=>s+v*repeats[i],0)} MAD — Бюджет: ${budget} MAD`;


    footer.innerText = `Итого распределено: ${pattern.reduce((s,v)=>s+v,0)} MAD — Бюджет: ${budget} MAD`;
    out.style.display = 'block';
    createRegenButton();

    // плавный скролл на мобилке к результату
    setTimeout(()=>{
      document.getElementById('output').scrollIntoView({behavior:'smooth', block:'start'});
    },120);
  }

  document.getElementById('gen').addEventListener('click', function(){
    const budget = Math.max(1, parseInt(document.getElementById('budget').value || '0', 10));
    if(!budget){
      alert('Введите корректный бюджет');
      return;
    }
    const pattern = computePattern(budget);
    render(budget, pattern);
  });

})();
</script>
</body>
</html>
